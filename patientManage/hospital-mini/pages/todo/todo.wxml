<view class="container">
  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="all">
      å…¨éƒ¨ ({{todos.length}})
    </view>
    <view class="filter-tab {{currentFilter === 'pending' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="pending">
      å¾…å®Œæˆ ({{pendingCount}})
    </view>
    <view class="filter-tab {{currentFilter === 'completed' ? 'active' : ''}}" bindtap="onFilterChange" data-filter="completed">
      å·²å®Œæˆ ({{completedCount}})
    </view>
  </view>

  <!-- å¾…åŠåˆ—è¡¨ -->
  <view class="todo-list">
    <view class="todo-item" wx:for="{{filteredTodos}}" wx:key="id">
      <view class="todo-checkbox" bindtap="onToggleTodo" data-id="{{item.id}}">
        <text class="checkbox-icon todo-checkbox-icon {{item.status === 0 ? 'checked' : ''}}">
          {{item.targetUserName}}
        </text>
      </view>
      
      <view class="todo-content" bindtap="onTodoShow" data-id="{{item.id}}">
        <view class="todo-header">
          <text class="todo-title {{item.status === 2 ? 'completed' : ''}}">{{item.title}}</text>
          <view class="priority-tag tag-{{item.urgency}}">{{item.priorityText}}</view>
        </view>
        
        <view class="todo-details">
          <text class="todo-patient">{{item.targetUserName}}</text>
          <text class="todo-time">{{item.executeTime}}</text>
        </view>

        <view class="todo-type">
          <text class="type-text" wx:for="{{item.operations}}" wx:key="opId" wx:for-item="operation">{{operation}}</text>
        </view>
      </view>

      <view class="todo-actions">
<!--        <view class="action-btn" catchtap="onEditTodo" data-id="{{item.id}}">-->
<!--          <text class="iconfont icon-edit">âœï¸</text>-->
<!--        </view>-->
        <view class="action-btn" catchtap="onDeleteTodo" data-id="{{item.id}}">
          <text class="iconfont icon-delete">ğŸ—‘ï¸</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredTodos.length === 0}}">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— å¾…åŠäº‹é¡¹</text>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="onAddTodo">
    <text class="iconfont icon-plus">+</text>
  </view>

    <!-- å¾…åŠäº‹é¡¹å¼¹çª— -->
    <view class="modal-mask" wx:if="{{showTodoDetail}}" >
        <view class="modal-content" catchtap="onModalContentTap">
            <view class="modal-header">
                <text class="modal-title">å¾…åŠè¯¦æƒ…</text>
                <view class="modal-close" bindtap="onTodoHidden">Ã—</view>
            </view>

            <view class="modal-body">
                <!-- äº‹é¡¹åç§° -->
                <view class="form-item">
                    <!-- <text class="form-label">ç—…æ‚£</text> -->
                    <input class="form-input" disabled value="{{todoDetail.targetUserName}}"/>
                </view>
                <view class="form-item">
                    <!-- <text class="form-label">äº‹é¡¹åç§°</text> -->
                    <input class="form-input" disabled value="{{todoDetail.title}}"/>
                </view>

                <!-- äº‹é¡¹å†…å®¹ -->
                <view class="form-item">
                    <!-- <text class="form-label">äº‹é¡¹å†…å®¹</text> -->
                    <textarea class="form-textarea" disabled value="{{todoDetail.content}}"/>
                </view>
                <!-- ç´§æ€¥ç¨‹åº¦ -->
                <view class="form-item">
                    <view class="priority-options">
                        <view class="priority-option active" >
                            <text class="priority-dot priority-dot-{{todoDetail.urgency}}"></text>
                            <text>{{todoDetail.priorityText}}</text>
                        </view>
                    </view>
                </view>

                <!-- äº‹é¡¹åç§° -->
                <view class="form-item">
                    <text class="form-label">æ‰§è¡Œæ—¶é—´</text>
                    <!-- <text class="form-label">ç—…æ‚£</text> -->
                    <input class="form-input" disabled value="{{todoDetail.executeTime}}"/>
                </view>

                <!-- æ“ä½œæ ‡ç­¾ -->
                <view class="form-item">
                    <view class="tag-options">
                        <view class="tag-option active" wx:for="{{todoDetail.operations}}" wx:key="opId" wx:for-item="value">
                            <text class="tag-text " >{{value}}</text>
                        </view>
                    </view>
                </view>
            </view>

            <view class="modal-footer">
                <button class="btn-cancel" wx:if="{{todoDetail.status === 0}}" bindtap="onTodoHidden">å–æ¶ˆ</button>
                <button class="btn-submit" wx:if="{{todoDetail.status === 0}}" bindtap="onFinishTodo" data-id="{{todoDetail.id}}">å®Œæˆ</button>
                <button class="btn-submit" wx:if="{{todoDetail.status === 2}}">å·²å®Œæˆ</button>
            </view>
        </view>
    </view>


  <!-- æ–°å¢å¾…åŠå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showAddModal}}" bindtap="onModalMaskTap">
    <view class="modal-content" catchtap="onModalContentTap">
      <view class="modal-header">
        <text class="modal-title">æ–°å¢å¾…åŠäº‹é¡¹</text>
        <view class="modal-close" bindtap="onAddModalCancel">Ã—</view>
      </view>

      <view class="modal-body">
        <!-- äº‹é¡¹åç§° -->
        <view class="form-item">
          <!-- <text class="form-label">ç—…æ‚£</text> -->
          <input class="form-input" placeholder="ç—…æ‚£å§“å/åºŠä½" value="{{addForm.targetUserName}}" bindinput="onAddTargetUserNameInput"/>
        </view>
        <view class="form-item">
          <!-- <text class="form-label">äº‹é¡¹åç§°</text> -->
          <input class="form-input" placeholder="è¯·è¾“å…¥äº‹é¡¹æ ‡é¢˜" value="{{addForm.title}}" bindinput="onAddTitleInput"/>
        </view>

        <!-- äº‹é¡¹å†…å®¹ -->
        <view class="form-item">
          <!-- <text class="form-label">äº‹é¡¹å†…å®¹</text> -->
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥äº‹é¡¹å†…å®¹" value="{{addForm.content}}" bindinput="onAddContentInput"/>
        </view>
        <!-- ç´§æ€¥ç¨‹åº¦ -->
        <view class="form-item">
          <text class="form-label">ç´§æ€¥ç¨‹åº¦</text>
          <view class="priority-options">
            <view class="priority-option {{addForm.priority === 1 ? 'active' : ''}}" bindtap="onPrioritySelect" data-priority="1">
              <text class="priority-dot low"></text>
              <text>è½»åº¦</text>
            </view>
            <view class="priority-option {{addForm.priority === 2 ? 'active' : ''}}" bindtap="onPrioritySelect" data-priority="2">
              <text class="priority-dot medium"></text>
              <text>æ­£å¸¸</text>
            </view>
            <view class="priority-option {{addForm.priority === 3 ? 'active' : ''}}" bindtap="onPrioritySelect" data-priority="3">
              <text class="priority-dot high"></text>
              <text>ç´§æ€¥</text>
            </view>
          </view>
        </view>

        <!-- æ‰§è¡Œæ—¶é—´ -->
        <view class="form-item">
          <text class="form-label">æ‰§è¡Œæ—¶é—´</text>
          <view class="time-inputs">
            <picker class=" picker-date" mode="date" value="{{addForm.date}}" bindchange="onDateChange">
              <view class="picker-item">
                <text class="picker-label">æ—¥æœŸ</text>
                <text class="picker-value">{{addForm.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</text>
              </view>
            </picker>
            <picker class=" picker-time" mode="time" value="{{addForm.time}}" bindchange="onTimeChange">
              <view class="picker-item">
                <text class="picker-label">æ—¶é—´</text>
                <text class="picker-value">{{addForm.time || 'è¯·é€‰æ‹©æ—¶é—´'}}</text>
              </view>
            </picker>
          </view>
        </view>

        <!-- æ“ä½œæ ‡ç­¾ -->
        <view class="form-item">
          <view class="form-label-row">
            <text class="form-label">æ“ä½œæ ‡ç­¾</text>
            <view class="tag-actions">
              <text class="tag-count" wx:if="{{addForm.tags.length > 0}}">å·²é€‰æ‹© {{addForm.tags.length}} é¡¹</text>
              <text class="tag-action-btn" bindtap="onSelectAllTags">å…¨é€‰</text>
              <text class="tag-action-btn" bindtap="onClearAllTags" wx:if="{{addForm.tags.length > 0}}">æ¸…ç©º</text>
            </view>
          </view>
          <view class="tag-options">
            <view class="tag-option {{item.select === 1 ? 'active' : ''}}"
                  wx:for="{{tagOptions}}"
                  wx:key="value"
                  bindtap="onTagToggle"
                  data-tag="{{item.value}}"
                  data-priority="{{item.priority}}">
              <text class="tag-text " >{{item.label}}</text>
              <text class="tag-check" wx:if="{{addForm.tags.includes(String(item.value))}}">âœ“</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-cancel" bindtap="onAddModalCancel">å–æ¶ˆ</button>
        <button class="btn-submit" bindtap="onAddModalSubmit">æäº¤</button>
      </view>
    </view>
  </view>
</view> 